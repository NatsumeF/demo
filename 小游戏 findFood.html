<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
	*{
		padding: 0;
		margin:0;
	}

	html,body,main{
		height: 100%;
		width: 100%;
	}
	.box{
		height: 20px;
		width: 20px;
		border-radius: 50%;
		background:red;
		position: absolute;
		left: 0;
		right: 0;
	}
	.lookFood{
		position: absolute;
		left: 50%;
		top:50%;
	}
	.food{
		height: 20px;
		width: 20px;
		background: #faa;
		border-radius: 50%;
		position: absolute;
	}
	</style>
</head>
<body>
<main>
	<div class="lookFood">获取了<span>0</span>个food</div>
	<div class="box"></div>
	<div class="food"></div>
</main>	
</body>

<script>
/**
 *键盘上下左右触发dom移动;
 *可以同时触发两个方向的事件;
 *传入两个参数:dom 需要移动的dom;
 *speed 每秒移动速度;
 */
var box = document.getElementsByClassName("box")[0],
	food = document.getElementsByClassName("food")[0],
	span = document.getElementsByTagName("span")[0],
	i = 1;

function foodInit() {
	food.style.left = Math.random() * parseInt(window.getComputedStyle(document.body).width) - 20 + "px";
	food.style.top = Math.random() * parseInt(window.getComputedStyle(document.body).height) - 20 + "px";
	food.style.background = '#' + (~~(Math.random() * (1 << 24))).toString(16);
}

function start() {
	var boxLeft = parseInt(window.getComputedStyle(box).left),
		boxTop = parseInt(window.getComputedStyle(box).top),
		foodLeft = parseInt(window.getComputedStyle(food).left),
		foodTop = parseInt(window.getComputedStyle(food).top);
	//console.log(Math.abs(boxLeft - foodLeft) + "left+" + Math.abs(boxTop - foodTop) + "top+" + parseInt(window.getComputedStyle(food).height))
	if (Math.abs(boxLeft - foodLeft) < parseInt(window.getComputedStyle(food).width) && Math.abs(boxTop - foodTop) < parseInt(window.getComputedStyle(food).height)) {
		span.innerHTML = i++;
		foodInit()
	}
}
var keyDomMove = (function() {
	var keyCode = {
		downKeyCode: function(e) {
			var e = e || window.event;
			if (e.keyCode === 37 || e.keyCode === 38 || e.keyCode === 39 || e.keyCode === 40) {
				keyCode[e.keyCode] = true;
			}
		},
		upKeyCode: function(e) {
			var e = e || window.event;
			if (keyCode[e.keyCode]) {
				keyCode[e.keyCode] = false;
			}
		},
		time: {},
	};

	return function(dom, main, speed) {
		if (typeof speed != "number") {
			speed = 1;
		} else {
			speed = (speed/60) > 1 ? (speed/60) : 1
		}
		var left = parseInt(window.getComputedStyle(dom).marginLeft),
			top = parseInt(window.getComputedStyle(dom).marginTop),
			mainHeigeht=parseInt(window.getComputedStyle(main).height)-20,
			mainWidth=parseInt(window.getComputedStyle(main).width)-20,
			changeXY=function(xy,min,max){
				if(xy<min){
					xy=max;
				}else if(xy>=max){
					xy=min;
				}
				return xy;
			};

		document.addEventListener("keydown", function(e) {
			keyCode.downKeyCode();
			if (keyCode[37] && !keyCode.time[37]) {
				keyCode.time[e.keyCode] = setInterval(function() {
					var x= dom.offsetLeft - left - speed ;
					x=changeXY(x,0,mainWidth);
					dom.style.left =x+"px";
					start()
				}, 50/3)

			};
			if (keyCode[38] && !keyCode.time[38]) {
				keyCode.time[e.keyCode] = setInterval(function() {
					var y = dom.offsetTop - top - speed 
					y=changeXY(y,0,mainHeigeht);
					dom.style.top=y+"px";
					start()
				}, 50/3)

			};
			if (keyCode[39] && !keyCode.time[39]) {
				keyCode.time[e.keyCode] = setInterval(function() {
					var x= dom.offsetLeft - left + speed ;
					x=changeXY(x,0,mainWidth);
					dom.style.left =x+"px";
				}, 50/3)

			};
			if (keyCode[40] && !keyCode.time[40]) {
				keyCode.time[e.keyCode] = setInterval(function() {
					var y = dom.offsetTop - top + speed ;
					y=changeXY(y,0,mainHeigeht);
					dom.style.top=y+"px";
					start()
				}, 50/3)

			};
			document.addEventListener("keyup", function(e) {
				keyCode.upKeyCode();
				clearInterval(keyCode.time[e.keyCode]);
				keyCode.time[e.keyCode] = null;
			})
		})

	}
})()

function init() {
	foodInit(food);
	keyDomMove(box, document.body,300);
}
init()
</script>
</html>